{"version":3,"sources":["unknown"],"names":["window","LATTICE_API","randomKey","LATTICEAI_ENV","includes","api","company_id","apikey","scriptSearchParams","Settings","Context","CurrentScript","session_id","lastActiveSeconds","cart_token","is_first_api_called","clientCountryCode","callApiEvent","getSessionId","current_time","Date","getTime","timeSpentOnPage","TimeMe","getTimeOnCurrentPageInSeconds","currantActiveSeconds","parseInt","inactive_start_time","getSessionInactiveTime","inactive_time","session_start_time","getSessionStartTime","setSessionStartTime","deleteSessionId","session_time","params","url","location","href","visit_time","uid","getUidCookie","pid","getPidCookie","browser_height","screen","height","browser_width","width","Services","createEventActivity","then","response","json","res","data","setSessionId","setSessionStatus","session_status","deleteSessionInactiveTime","catch","error","console","log","isCookiesEnabled","document","cookie","cookiesEnabled","indexOf","e","startTrackingScript","timeScriptUrl","shopagain_timeme_script_url","URL","src","timemeScript","createElement","toString","async","type","head","appendChild","addEventListener","initialize","currentPageName","idleTimeoutInSeconds","callWhenUserLeaves","time","setSessionInactiveTime","callWhenUserReturns","status","getSessionStatus","setInterval","isActive","cookieInterval","getCartToken","clearInterval","addWidgetScript","scriptUrl","currentScriptUrlObj","currentScriptSearchParams","searchParams","store","get","Shopify","shop","windowUrl","hostname","scriptId","existingScript","getElementById","widgetScript","widgetScriptSrcUrl","shopagain_widget_script_url","host","append","forEach","value","key","id","start","currentScript","warn","windowHref","parsedWindowHref","audience_user_id","setUidCookie","popUpSessionMap","getPopUpSessionMap","customerId","ShopifyAnalytics","meta","page","resp","getPopupUser","client_country_code","setPidCookie","deleteUidCookie","onbeforeunload","event","handleScroll","currentSeconds","handleTimerTick","addEvent","obj","evt","fn","attachEvent","from","relatedTarget","toElement","nodeName","clientY","PopupQueue","push","ExitQueue","processNextPopup","onMobileDeviceClassname","body","classList","add","myScrollSpeedFunction","contains","my_scroll","last_position","new_position","timer","delta","delay","clear","scrollY","clearTimeout","setTimeout","settings","getConfig","read_cookie","forms","querySelectorAll","form","AddToCartQueue","length","FormData","startTime","now","Object","fromEntries","page_url","fetch","getUrl","updateOptions","method","JSON","stringify","headers","endTime","apiCallDuration","timeoutDuration","Math","max","widgetData","popups","popup","checkIfPopupCanBeShown","behaviour","schedule","targeting","timing","frequency","days_after_closing","timingType","inclusion_rules","exclusion_rules","inclusionRulesEmpty","rules","customRules","rulesEmpty","ruleMatchingUrl","exiting","scroll_percent","seconds_after_page_load","add_to_cart","addToScrollQueue","addToTimerQueue","addToExitQueue","addToAddToCartQueue","rule","urlStr","path","pathname","i","ScrollQueue","TimerQueue","lastKnownScrollPosition","h","documentElement","b","st","sh","percent","clientHeight","scrollQueueKeys","keys","scrollPKey","Number","seconds","timerQueueKeys","timerKey","scrollPercent","ShowingPopup","newPopup","splice","enable","before_popup","minimize_icon_config","isMobileDevice","displayButtonToShowLastPopup","setPopUpSessionMap","displayPopup","container","containerElement","remove","createPopupActivity","getOwnPropertyNames","activityType","lastPopUpButton","querySelector","popup_config","flyoutPosition","popupType","animateFlyout","sideImageSrc","version","after_popup_cancel","formDoc","successDoc","formData","successData","wrapperCss","css","commonCss","html","js","randomNumber","floor","random","containerClassName","iframeId","popupAnimationClassName","buttonSpinnerClassname","ifrm","setAttribute","style","visibility","position","top","left","zIndex","background","getFontLinks","getElement","selector","parent","Promise","resolve","contentWindow","modalElement","doesPointCollide","p","box","x","right","y","bottom","doesPhoneInputDropdownCollide","dropdown","getBoundingClientRect","timesPerSecond","wait","handleIframePointerEventChange","point","clientX","pointerEvents","contentDocument","handleIframeTouchEventChange","touches","closeIcon","popupViewId","round","popup_open_seconds","popup_timer","isFormSubmitted","closePopup","isBackdropClickedEvent","target","popupClassNames","popupBackdrop","removeEventListener","bake_cookie","seconds_open","view_id","onclick","email_fields","email_field","name_elements","submitButtons","processButtons","isSuccess","buttons","button","buttonAction","getAttribute","trim","test","open","discountBlock","el","textContent","select","execCommand","removeChild","enableSubmitButtonsLoading","disableSubmitButtonsLoading","removeAttribute","imageElements","imageEl","cursor","selectElements","selectElement","emptyOption","innerText","insertBefore","firstChild","radioElements","processedRadioContainers","radioElement","parentNode","name","required","hasAttribute","childRadioElements","childRadioElement","checkboxElements","processedCheckboxContainers","checkboxElement","childCheckboxElements","childCheckboxElement","onIntlTelInputLoad","telInputElement","iti","intlTelInputGlobals","getInstance","setCountry","display","dropdownContainer","phoneInput","input","inputParent","insertAdjacentHTML","errorMsg","validMsg","errorMap","reset","innerHTML","isValidNumber","errorCode","getValidationError","preventDefault","formProps","number","getNumber","mobile","endsWith","fields","values","field","checked","slice","formSubmitResp","submitForm","ok","Error","formSubmitRespJson","respSuccessDoc","respUid","outerWrapper","outerWrapperHeight","offsetHeight","minHeight","elementCssStyleElement","formContanier","formElement","calculateAndSetClasses","formParent","popupModal","className","popupWindow","flyoutWindow","flyoutBackdrop","generalPrefix","charAt","slideInAnimation","backdrop","scripts","getElementsByTagName","script","newScript","widgetContainer","apiBase","getFullCookieName","is_shopagain_widget_popup","details","vertical_position","horizontal_position","background_color","margin","borderRadius","minimize_icon","show_days_after_closing","popupSubmitted","popup_cookie","popupShown","popupShownDate","timeDiff","abs","days_since_close","isNaN","doc","fontMatches","match","font","fontName","Set","loadUrlLinks","fontMatch","customFonts","find","customFont","toLowerCase","fontLinksString","map","join","submitHandler","firstName","emailAddress","cookieName","isSessionBased","date","days","setTime","expires","toUTCString","getSameNameCookie","parts","split","pop","shift","exactName","result","RegExp","parse","delete_cookie","deletePidCookie","navigator","userAgent","preloadImagesFromHtmlString","htmlString","imageUrls","images","filter","image","reject","img","Image","onload","onerror","allSettled","slideInAnimationKeyFrame","getQueryString","parameters","kvps","qs","options","update","entries","newBody","script_query_params","baseUrl","shopify_customer_id","user_timezone","Intl","DateTimeFormat","resolvedOptions","timeZone","getCartDetails","createOrUpdateCart","activity_type","queryStringParams","isMobile","form_data","polyfillScript"],"mappings":"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","sourcesContent":["if (!window.LATTICE_API) window.LATTICE_API = \"https://mean-chicken-chew-103-79-255-85.loca.lt/\";\n\n\n(function () {\n    const randomKey = \"TDVnebyb7k\";\n\n    const LATTICEAI_ENV = (function () {\n        if (window.LATTICE_API.includes(\"api.latticeai.io\") || window.LATTICE_API.includes(\"api.shopagain.io\")) {\n            return \"prod\";\n        }\n        else if (window.LATTICE_API.includes(\"mercuryapi-staging.latticeai.io\")) {\n            return \"staging\";\n        }\n        else {\n            return \"dev\";\n        }\n    })();\n\n\n    var api = {\n        company_id: null,\n        apikey: null,\n        scriptSearchParams: null,\n        Settings: {},\n        Context: {},\n        CurrentScript: null,\n        session_id: null,\n        lastActiveSeconds: 0,\n        cart_token: null,\n        is_first_api_called: false,\n\n        clientCountryCode: null,\n\n        callApiEvent: function () {\n            api.session_id = api.getSessionId()\n            const current_time = new Date().getTime();\n            let timeSpentOnPage = TimeMe.getTimeOnCurrentPageInSeconds();\n            let currantActiveSeconds = parseInt(timeSpentOnPage) - api.lastActiveSeconds;\n            api.lastActiveSeconds = parseInt(timeSpentOnPage);\n\n            let inactive_start_time = api.getSessionInactiveTime()\n            let inactive_time = 0\n            if (inactive_start_time && inactive_start_time > 0 && current_time >= inactive_start_time) {\n                inactive_time = (current_time - inactive_start_time) / 1000\n            }\n\n            let session_start_time = api.getSessionStartTime()\n            if (!session_start_time || current_time < session_start_time || !api.session_id) {\n                api.setSessionStartTime(current_time)\n                session_start_time = current_time\n                api.deleteSessionId()\n                api.session_id = null\n                inactive_time = 0\n            }\n            let session_time = (current_time - session_start_time) / 1000\n            const params = {\n                session_id: api.session_id,\n                url: window.location.href,\n                visit_time: currantActiveSeconds,\n                uid: api.getUidCookie(),\n                pid: api.getPidCookie(),\n                session_time: session_time,\n                inactive_time: inactive_time,\n                cart_token: api.cart_token || null,\n                browser_height: window.screen.height,\n                browser_width: window.screen.width,\n\n            }\n            api.Services.createEventActivity(params)\n                .then(function (response) {\n                    return response.json()\n                })\n                .then(function (res) {\n                    const data = res.data\n                    if (data) {\n                        api.session_id = data?.session_id\n                        api.setSessionId(data?.session_id)\n                        api.setSessionStatus(data?.session_status)\n                        if (data?.session_status === \"FIRST_ACTIVE\") {\n                            api.setSessionStartTime(new Date().getTime())\n                            api.deleteSessionInactiveTime()\n                        }\n                        if (data?.session_status === \"INACTIVE\") {\n                            api.deleteSessionInactiveTime()\n                        }\n                    }\n\n                }).catch(function (error) {\n                    console.log(error)\n                })\n        },\n        isCookiesEnabled: function () {\n            try {\n                document.cookie = 'cookietest=1';\n                var cookiesEnabled = document.cookie.indexOf('cookietest=') !== -1;\n                document.cookie = 'cookietest=1; expires=Thu, 01-Jan-1970 00:00:01 GMT';\n                return cookiesEnabled;\n            } catch (e) {\n                return false;\n            }\n        },\n\n        startTrackingScript: function () {\n            const timeScriptUrl = window.shopagain_timeme_script_url ?\n                new URL(\"\", window.shopagain_timeme_script_url) : new URL('/shopify/timeme.js', new URL(api.CurrentScript.src).href);\n            const timemeScript = document.createElement('script')\n            timemeScript.src = timeScriptUrl.toString()\n            timemeScript.async = true\n            timemeScript.type = 'text/javascript'\n            document.head.appendChild(timemeScript)\n\n            timemeScript.addEventListener(\"load\", function () {\n                TimeMe.initialize({\n                    currentPageName: window.location.href, // current page\n                    idleTimeoutInSeconds: 5, // stop recording time due to inactivity\n                });\n\n                api.callApiEvent()\n                api.is_first_api_called = true\n                api.deleteSessionInactiveTime()\n\n                TimeMe.callWhenUserLeaves(function () {\n                    if (api.is_first_api_called) {\n                        const time = new Date().getTime()\n                        api.setSessionInactiveTime(time)\n                    }\n                })\n                TimeMe.callWhenUserReturns(\n                    function () {\n                        if (api.is_first_api_called) {\n                            api.deleteSessionInactiveTime()\n                            const status = api.getSessionStatus()\n                            if (status === \"INACTIVE\") {\n                                api.setSessionStartTime(new Date().getTime())\n                            }\n                            api.setSessionStatus(\"ACTIVE\")\n                        }\n                    }\n                )\n                // TimeMe.callAfterTimeElapsedInSeconds(3,\n                //     function () {\n                //         api.callApiEvent()\n                //         api.is_first_api_called = true\n                //     }\n                // );\n\n                setInterval(function async() {\n                    const isActive = api.getSessionStatus() !== \"INACTIVE\"\n                    if (isActive)\n                        api.callApiEvent()\n                }, 30000);\n\n                if (!api.cart_token) {\n                    var cookieInterval = setInterval(function () {\n                        const cart_token = api.getCartToken()\n                        if (cart_token && api.is_first_api_called) {\n                            api.cart_token = cart_token\n                            clearInterval(cookieInterval)\n                            api.callApiEvent()\n                        }\n                    }, 3000);\n                }\n            });\n\n        },\n\n        addWidgetScript: function (scriptUrl) {\n            const currentScriptUrlObj = new URL(scriptUrl);;\n            const currentScriptSearchParams = currentScriptUrlObj.searchParams;\n            api.scriptSearchParams = currentScriptSearchParams;\n            const store = currentScriptSearchParams.get(\"store\");\n            if ((!window.Shopify || !window.Shopify.shop) && store !== \"woocommerce\") {\n                console.log(\"skipping widgets...\");\n                return;\n            }\n            let shop = \"\";\n            if (store === \"woocommerce\") {\n                const windowUrl = new URL(window.location.href);\n                shop = windowUrl.hostname;\n            }\n            else {\n                shop = window.Shopify.shop;\n            }\n\n            const scriptId = `shopagain-widget-script-${LATTICEAI_ENV}`;\n            const existingScript = document.getElementById(scriptId);\n            if (existingScript) {\n                return\n            }\n            const widgetScript = document.createElement('script');\n            const widgetScriptSrcUrl = window.shopagain_widget_script_url ?\n                new URL(\"\", window.shopagain_widget_script_url) : new URL(`/shopify/widgets.js`, `https://${scriptUrl.host}`);\n            widgetScriptSrcUrl.searchParams.append(\"shop\", shop);\n            widgetScriptSrcUrl.searchParams.append(\"v\", 4);\n\n            //forward query parameters from current script\n            currentScriptSearchParams.forEach((value, key) => {\n                widgetScriptSrcUrl.searchParams.append(key, value);\n            });\n\n            widgetScript.src = widgetScriptSrcUrl.toString();\n            widgetScript.id = scriptId;\n            widgetScript.type = 'text/javascript';\n            document.head.appendChild(widgetScript);\n        },\n\n\n        start: async function () {\n            //The start function handles widget initialization.\n            //Get the company\n            const currentScript = api.CurrentScript\n            const src = currentScript.src\n            const scriptUrl = new URL(src);\n            const scriptSearchParams = scriptUrl.searchParams;\n            api.scriptSearchParams = scriptSearchParams;\n            const shop = scriptSearchParams.get('shop');\n            const company_id = scriptSearchParams.get('company_id');\n            const apikey = scriptSearchParams.get('webkey');\n            const store = scriptSearchParams.get('store');\n\n            if (!company_id && !apikey) {\n                console.warn(\"company_id or apikey is required\");\n                return;\n            }\n\n            api.company_id = company_id;\n            api.apikey = apikey;\n\n            const windowHref = window.location.href\n            const parsedWindowHref = new URL(windowHref)\n            const params = parsedWindowHref.searchParams\n            const audience_user_id = params.get('sa_a_id')\n            if (audience_user_id) {\n                api.setUidCookie(audience_user_id)\n            }\n\n            api.popUpSessionMap = api.getPopUpSessionMap()\n            const session_id = api.getSessionId()\n            const session_start_time = api.getSessionStartTime()\n            api.cart_token = api.getCartToken()\n            if (session_id) {\n                api.session_id = session_id\n            }\n            if (!session_id || !session_start_time) {\n                api.setSessionStartTime(new Date().getTime())\n            }\n            const customerId = window?.ShopifyAnalytics?.meta?.page?.customerId || null\n\n            const resp = await api.Services.getPopupUser(customerId, api.getPidCookie(), api.getUidCookie())\n            const data = await resp.json()\n            const pid = data.pid\n            const uid = data.uid\n            api.clientCountryCode = data.client_country_code\n            window.clientCountryCode = data.client_country_code\n\n            api.setPidCookie(pid)\n            if (uid) {\n                api.setUidCookie(uid)\n            }\n            else {\n                api.deleteUidCookie()\n            }\n\n            // start pixel tracking after pid is set\n            if (company_id || store === \"woocommerce\") {\n                api.startTrackingScript();\n            }\n\n            window.onbeforeunload = function (event) {\n                const time = new Date().getTime()\n                api.setSessionInactiveTime(time)\n            };\n\n            document.addEventListener('scroll', api.handleScroll);\n            let currentSeconds = 0\n            setInterval(() => {\n                api.handleTimerTick(++currentSeconds)\n            }, 1000)\n\n\n\n            var addEvent = function (obj, evt, fn) {\n                if (obj.addEventListener) {\n                    obj.addEventListener(evt, fn, false);\n                }\n                else if (obj.attachEvent) {\n                    obj.attachEvent(\"on\" + evt, fn);\n                }\n            };\n\n            addEvent(document, \"mouseout\", function (event) {\n                event = event ? event : window.event;\n                var from = event.relatedTarget || event.toElement;\n                if ((!from || from.nodeName == \"HTML\") && event.clientY <= 100) {\n                    // console.log('user about to exit')\n\n                    api.PopupQueue.push(...api.ExitQueue)\n                    api.processNextPopup()\n                    api.ExitQueue = []\n\n                }\n            });\n\n\n\n            const onMobileDeviceClassname = 'latticeai-on-mobile-device';\n            document.addEventListener(\"touchstart\", function () {\n                document.body.classList.add(onMobileDeviceClassname)\n            });\n\n            function myScrollSpeedFunction() {\n                if (document.body.classList.contains(onMobileDeviceClassname)) {\n                    if (my_scroll() < -30) {\n                        api.PopupQueue.push(...api.ExitQueue)\n                        api.processNextPopup()\n                        api.ExitQueue = []\n                    }\n                }\n            }\n\n            var my_scroll = (function () { //Function that checks the speed of scrolling\n                var last_position, new_position, timer, delta, delay = 50;\n                function clear() {\n                    last_position = null;\n                    delta = 0;\n                }\n\n                clear();\n                return function () {\n                    new_position = window.scrollY;\n                    if (last_position != null) {\n                        delta = new_position - last_position;\n                    }\n                    last_position = new_position;\n                    clearTimeout(timer);\n                    timer = setTimeout(clear, delay);\n                    return delta;\n                };\n            })();\n\n            document.addEventListener(\"scroll\", myScrollSpeedFunction);\n\n\n            //Load the store owner's widget settings\n            const settings = await (await api.Services.getConfig(\n                api.read_cookie('pid'),\n                api.read_cookie('uid')\n            )).json()\n            api.Settings = settings;\n\n            // console.log(settings, 'settings loaded');\n\n            try {\n                const forms = [...document.querySelectorAll(`form[action*=\"/cart/add\"]`)];\n                for (let form of forms) {\n                    form.addEventListener(\"submit\", function (e) {\n                        if (api.AddToCartQueue.length) {\n                            const data = new FormData(form);\n                            const startTime = Date.now();\n                            const body = {\n                                ...Object.fromEntries(data),\n                                page_url: window.location.href\n                            };\n                            fetch(\n                                api.Services.getUrl(`/campaigns/popups/cross_sell_popop/`),\n                                api.Services.updateOptions({\n                                    method: 'POST',\n                                    body: JSON.stringify(body),\n                                    headers: {\n                                        'Content-Type': 'application/json'\n                                    },\n                                })\n                            )\n                                .then((resp) => resp.json())\n                                .then((data) => {\n                                    if (api.AddToCartQueue.length) {\n                                        const endTime = Date.now();\n                                        const apiCallDuration = endTime - startTime;\n                                        const timeoutDuration = Math.max(2000 - apiCallDuration, 0);\n\n                                        setTimeout(() => {\n                                            api.PopupQueue.push({\n                                                ...api.AddToCartQueue[0],\n                                                widgetData: data\n                                            });\n                                            api.processNextPopup();\n                                        }, timeoutDuration);\n                                    }\n                                })\n                        }\n                    })\n                }\n            }\n            catch (e) {\n                console.log(e)\n            }\n\n\n            const popups = settings || []\n            popups.forEach((popup) => {\n\n                if (!this.checkIfPopupCanBeShown(popup)) {\n                    return;\n                }\n\n                const { behaviour, schedule, targeting } = popup\n                const { timing, frequency } = behaviour\n                const { days_after_closing } = frequency\n                const { type: timingType } = timing\n                const { url } = targeting\n                const { inclusion_rules, exclusion_rules } = url\n\n                const inclusionRulesEmpty = !inclusion_rules?.rules?.length\n                    && !inclusion_rules?.customRules?.length\n\n                const rulesEmpty = inclusionRulesEmpty\n                    && !exclusion_rules?.rules?.length\n                    && !exclusion_rules?.customRules?.length\n\n                if (!rulesEmpty) {\n                    if (api.ruleMatchingUrl(exclusion_rules)) return\n                    if (!inclusionRulesEmpty && !api.ruleMatchingUrl(inclusion_rules)) return\n                }\n\n\n                if (timingType === 'immediate') {\n                    api.PopupQueue.push(popup)\n                }\n                else if (timingType === 'delay') {\n                    const { exiting, scroll_percent, seconds_after_page_load, add_to_cart } = timing\n                    if (scroll_percent) {\n                        api.addToScrollQueue(popup, scroll_percent)\n                    }\n                    if (seconds_after_page_load) {\n                        api.addToTimerQueue(popup, seconds_after_page_load)\n                    }\n                    if (exiting) {\n                        api.addToExitQueue(popup)\n                    }\n                    if (add_to_cart) {\n                        api.addToAddToCartQueue(popup);\n                    }\n                    //invalid setting\n                    if (!scroll_percent && !seconds_after_page_load && !exiting && !add_to_cart) {\n                        api.PopupQueue.push(popup)\n                    }\n                }\n\n            })\n\n            api.handleScroll()\n            api.processNextPopup()\n\n\n\n        },\n\n        ruleMatchingUrl: function (rule) {\n            const { rules, customRules } = rule\n            const urlStr = window.location.href\n            const url = new URL(urlStr)\n            const path = url.pathname\n            // console.log(path)\n            if (rules.includes(\"all_pages\")) return true\n            if (rules.includes(\"home_page\") && (path === '/' || !path)) return true\n            if (rules.includes(\"product_pages\") && path.includes('/products/')) return true\n            if (rules.includes(\"about_page\") && path.includes('/about')) return true\n\n            if (customRules) {\n                for (let i = 0; i < customRules.length; i++) {\n                    const { value, type } = customRules[i]\n                    if (type === 'exact_match') {\n                        if (path === value) return true\n                    }\n                    if (type === 'contains') {\n                        if (path.includes(value)) return true\n                    }\n\n                }\n            }\n\n        },\n\n\n        ScrollQueue: {},\n        TimerQueue: {},\n        ExitQueue: [],\n        AddToCartQueue: [],\n\n        handleScroll() {\n            let lastKnownScrollPosition = window.scrollY;\n            // console.log(lastKnownScrollPosition)\n\n            var h = document.documentElement,\n                b = document.body,\n                st = 'scrollTop',\n                sh = 'scrollHeight';\n\n            var percent = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;\n\n            // console.log(percent)\n\n            const scrollQueueKeys = Object.keys(api.ScrollQueue)\n            scrollQueueKeys.forEach((scrollPKey => {\n                // console.log(scrollPKey)\n                if (Number(scrollPKey) <= percent) {\n                    api.PopupQueue.push(...api.ScrollQueue[scrollPKey])\n                    delete api.ScrollQueue[scrollPKey]\n                }\n            }))\n\n            api.processNextPopup()\n\n        },\n\n        handleTimerTick(seconds) {\n            // console.log(seconds)\n\n            const timerQueueKeys = Object.keys(api.TimerQueue)\n            timerQueueKeys.forEach((timerKey => {\n                // console.log(timerKey)\n                if (Number(timerKey) <= seconds) {\n                    api.PopupQueue.push(...api.TimerQueue[timerKey])\n                    delete api.TimerQueue[timerKey]\n                }\n            }))\n\n            api.processNextPopup()\n\n        },\n\n        addToScrollQueue: function (popup, scrollPercent) {\n            if (api.ScrollQueue[scrollPercent]) {\n                api.ScrollQueue[scrollPercent].push(popup)\n            }\n            else {\n                api.ScrollQueue[scrollPercent] = [popup]\n            }\n        },\n\n        addToTimerQueue: function (popup, seconds) {\n            if (api.TimerQueue[seconds]) {\n                api.ScrollQueue[seconds].push(popup)\n            }\n            else {\n                api.TimerQueue[seconds] = [popup]\n            }\n        },\n\n        addToExitQueue: function (popup) {\n            api.ExitQueue.push(popup)\n        },\n\n\n        addToAddToCartQueue: function (popup) {\n            api.AddToCartQueue.push(popup)\n        },\n\n\n\n        PopupQueue: [],\n        ShowingPopup: false,\n        popUpSessionMap: {},\n        processNextPopup: function () {\n            if (!api.PopupQueue?.length) return\n            const newPopup = api.PopupQueue.splice(0, 1)[0];\n            if (this.ShowingPopup && !newPopup.widgetData) return\n\n            if (!this.checkIfPopupCanBeShown(newPopup)) {\n                api.processNextPopup()\n                return\n            }\n            const { enable, before_popup } = newPopup.minimize_icon_config\n            if (enable && before_popup && !api.isMobileDevice()) {\n                api.displayButtonToShowLastPopup(newPopup)\n                return\n            }\n\n            if (api.popUpSessionMap && api.popUpSessionMap[api.session_id] && api.popUpSessionMap[api.session_id] !== newPopup.id + \"-\") {\n                api.processNextPopup()\n                return;\n            }\n            api.popUpSessionMap[api.session_id] = newPopup.id + \"-\"\n            api.setPopUpSessionMap(api.popUpSessionMap)\n\n            api.displayPopup(newPopup).catch((e) => {\n                console.log(e)\n                const container = \"latticeai-popup-container\";\n                const containerElement = document.getElementById(container);\n                // destroy popup container on exception\n                if (containerElement) {\n                    containerElement.remove();\n                }\n                api.Services.createPopupActivity(newPopup.id, \"EXCEPTION\", JSON.stringify(e, Object.getOwnPropertyNames(e)));\n            });\n            api.ShowingPopup = true;\n        },\n\n\n        displayPopup: async function (popup, activityType = \"VIEWED\") {\n            const lastPopUpButton = document.querySelector('.latticeai-popup-revert-button');\n            if (lastPopUpButton) {\n                lastPopUpButton.remove();\n            }\n\n\n            const { behaviour, schedule, targeting, popup_config } = popup\n            const { timing, frequency } = behaviour\n            const { days_after_closing } = frequency\n            const { flyoutPosition, type: popupType, animateFlyout, sideImageSrc, version } = popup_config\n            const { enable, after_popup_cancel } = popup.minimize_icon_config\n\n            let formDoc = '';\n            let successDoc = '';\n\n            if (version) {\n                const { formData, successData } = popup;\n                formDoc = `\n                <style id=\"wrapperCss\">\n                    ${popup.wrapperCss}\n                </style>\n                <style id=\"elementsCss\">\n                    ${formData.css}\n                </style>\n                <style id=\"commonCss\">\n                    ${popup.commonCss}\n                </style>\n\n                <style>\n                    * {box-sizing: border-box;}\n                    body {margin: 0;}\n                </style>\n\n                <div>\n                    <div id=\"ijwx\">\n                        <svg class=\"la-popup-close-icon\" width=\"25px\" height=\"25px\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" id=\"clos\"><path d=\"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z\" fill=\"none\" stroke=\"currentColor\" stroke-miterlimit=\"10\" stroke-width=\"32\"></path><path d=\"M320 320L192 192M192 320l128-128\" fill=\"none\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"32\"></path></svg>\n                        <div data-gjs-type=\"OUTER_WRAPPER\" id=\"OUTER_WRAPPER\">\n                            <div id=\"SIDE_IMAGE_WRAPPER\">\n                                <img src=\"${sideImageSrc}\" id=\"SIDE_IMAGE\"/>\n                            </div>\n                            <form id=\"FORM_CONTAINER\">\n                                ${formData.html}\n                            </form>\n                        </div>\n                    </div>\n                </div>\n\n                <script>\n                    ${formData.js}\n                </script>\n            `\n\n                successDoc = successData.html;\n            }\n            else {\n                formDoc = popup.formDoc\n                successDoc = popup.successDoc\n            }\n\n\n            // await this.preloadImagesFromHtmlString(formDoc)\n            // this.preloadImagesFromHtmlString(successDoc)\n\n            const randomNumber = Math.floor(Math.random() * 1000000);\n            const containerClassName = 'latticeai-popup-container';\n            const iframeId = `latticeai-popup-iframe-${randomNumber}`;\n            const popupAnimationClassName = 'latticeai-start-popup-animation';\n            const buttonSpinnerClassname = 'latticeai-button-spinner-' + randomNumber;\n\n            let container = document.createElement('div')\n            let ifrm = document.createElement(\"iframe\");\n            ifrm.setAttribute(\"id\", iframeId);\n            ifrm.style.visibility = 'hidden';\n            ifrm.style.width = \"100%\";\n            ifrm.style.height = \"100%\";\n            ifrm.style.position = \"fixed\";\n            ifrm.style.top = \"0\";\n            ifrm.style.left = \"0\";\n            ifrm.style.zIndex = \"2147483647\";\n            ifrm.setAttribute(\"frameborder\", \"0\");\n            ifrm.style.background = \"transparent\";\n            ifrm.setAttribute(\"srcdoc\", `\n                <html>\n                    <head>\n                        ${api.getFontLinks(`${formDoc} ${successDoc}`) || ''}\n                    </head>\n\n                    <body>\n                        <div class=\"${containerClassName}\">\n\n                            <style>\n                                @keyframes spinner-${randomNumber} {\n                                    to {transform: rotate(360deg);}\n                                }\n                    \n                                body {\n                                    text-rendering: optimizeSpeed;\n                                    line-height: 1.5;\n                                }\n\n                                span {\n                                    display: inline-block;\n                                }\n                                \n                                .${containerClassName} .${buttonSpinnerClassname}:before {\n                                    content: '';\n                                    box-sizing: border-box;\n                                    position: absolute;\n                                    top: 50%;\n                                    left: 50%;\n                                    width: 20px;\n                                    height: 20px;\n                                    margin-top: -10px;\n                                    margin-left: -10px;\n                                    border-radius: 50%;\n                                    border-top: 2px solid #07d;\n                                    border-right: 2px solid transparent;\n                                    animation: spinner-${randomNumber} .6s linear infinite;\n                                }\n                    \n                    \n                                .${containerClassName} button[disabled]{\n                                    border: 1px solid #999999;\n                                    background-color: #cccccc !important;\n                                    color: #666666 !important;\n                                }\n                    \n                                .iti__flag {\n                                    display:block !important\n                                }\n\n                                .hide {\n                                    display: none !important;\n                                }\n                                \n                            </style>\n\n\n                            ${formDoc}\n                        </div>\n                        ${popupType === 'popup' ? `\n                            <style>\n                                @keyframes fadein {\n                                    from { opacity: 0; }\n                                    to   { opacity: 1; }\n                                }\n                \n                                .${popupAnimationClassName} {\n                                    opacity: 0;\n                                    animation: fadein 1s forwards;\n                                }\n                            </style>\n                            ` : ''}\n                    </body>\n                </html>\n            `)\n            container.appendChild(ifrm);\n\n\n            container.classList.add(containerClassName)\n\n            const body = document.body\n            body.appendChild(container)\n\n            setTimeout(async () => {\n\n                const getElement = (selector, parent) => new Promise(async (resolve) => {\n                    while (!parent().querySelector(selector)) {\n                        console.log('waiting for element', selector)\n                        await new Promise(res => setTimeout(res, 100));\n                    }\n                    resolve(parent().querySelector(selector))\n                });\n\n                container = await getElement(`.${containerClassName}`, () => ifrm.contentWindow.document);\n                let modalElement = await getElement('#ijwx', () => container);\n                if (version) {\n                    await getElement('#FORM_CONTAINER', () => container);\n                    await getElement('#OUTER_WRAPPER', () => container);\n                }\n\n                function doesPointCollide(p, box) {\n                    return !(p.x < box.left || p.x > box.right || p.y > box.bottom || p.y < box.top)\n                }\n\n                function doesPhoneInputDropdownCollide(p) {\n                    const dropdown = ifrm.contentWindow.document.querySelector('.iti__country-list');\n                    if (!dropdown) return false;\n                    const box = dropdown.getBoundingClientRect();\n                    return doesPointCollide(p, box);\n                }\n\n                var timesPerSecond = 20;\n                var wait = false;\n                const handleIframePointerEventChange = (e) => {\n                    if (popupType !== 'flyout') {\n                        return;\n                    }\n\n\n                    if (!wait) {\n                        const box = modalElement.getBoundingClientRect()\n                        const point = { x: e.clientX, y: e.clientY };\n                        if (doesPointCollide(point, box) || doesPhoneInputDropdownCollide(point)) {\n                            ifrm.style.pointerEvents = \"auto\"\n                        }\n                        else {\n                            ifrm.style.pointerEvents = \"none\"\n                        }\n\n                        wait = true;\n                        setTimeout(function () {\n                            wait = false;\n                        }, 1000 / timesPerSecond);\n                    }\n\n                }\n\n                document.addEventListener(\"mousemove\", handleIframePointerEventChange)\n                ifrm.contentDocument.addEventListener(\"mousemove\", handleIframePointerEventChange)\n\n                const handleIframeTouchEventChange = (e) => {\n                    if (popupType !== 'flyout') {\n                        return;\n                    }\n                    const clientX = e.touches[0].clientX;\n                    const clientY = e.touches[0].clientY;\n                    const box = modalElement.getBoundingClientRect()\n                    const point = { x: clientX, y: clientY };\n                    if (doesPointCollide(point, box) || doesPhoneInputDropdownCollide(point)) {\n                        ifrm.style.pointerEvents = \"auto\"\n                    }\n                    else {\n                        ifrm.style.pointerEvents = \"none\"\n                    }\n                }\n\n\n                document.addEventListener('touchstart', handleIframeTouchEventChange);\n                ifrm.contentDocument.addEventListener('touchstart', handleIframeTouchEventChange);\n\n                const closeIcon = await getElement(`.la-popup-close-icon`, () => container);\n                const popupViewId = (Math.round(Date.now())).toString(36);\n\n                let popup_open_seconds = 0\n                const popup_timer = setInterval(() => {\n                    popup_open_seconds++\n                }, 1000)\n\n\n                let isFormSubmitted = false\n\n                const closePopup = (e, isBackdropClickedEvent) => {\n                    if (isBackdropClickedEvent) {\n                        if (!e?.target?.classList?.contains?.(this.popupClassNames.popupBackdrop)) {\n                            return;\n                        }\n                        if (popupType !== 'popup') {\n                            return;\n                        }\n                    }\n\n                    clearInterval(popup_timer)\n                    ifrm.remove()\n\n                    //remove events\n                    document.removeEventListener(\"mousemove\", handleIframePointerEventChange)\n                    document.removeEventListener('touchstart', handleIframeTouchEventChange);\n\n                    if (!isFormSubmitted) {\n                        if (enable && after_popup_cancel && !api.isMobileDevice())\n                            api.displayButtonToShowLastPopup(popup)\n                        api.bake_cookie(`popup-${popup.id}-closed-at`, new Date())\n\n                        api.Services.createPopupActivity(popup.id, 'CLOSED', { seconds_open: popup_open_seconds, view_id: popupViewId })\n                        if (popup_open_seconds <= 5) {\n                            api.Services.createPopupActivity(popup.id, 'CLOSED_5S', { seconds_open: popup_open_seconds, view_id: popupViewId })\n                        }\n                    }\n                }\n\n                closeIcon.onclick = closePopup;\n\n\n                const email_fields = container.querySelectorAll('input[name=\"email\"]')\n                email_fields.forEach(email_field => {\n                    //set type to email\n                    email_field.setAttribute('type', 'email')\n                })\n                // console.log({ email_fields })\n\n                const name_elements = container.querySelectorAll('[name]')\n                // console.log({ name_elements })\n\n\n                // console.log({ buttons })\n\n                const submitButtons = []\n\n                const processButtons = (isSuccess) => {\n                    const buttons = container.querySelectorAll('[data-button-action]');\n                    buttons.forEach(button => {\n                        const buttonAction = button.getAttribute('data-button-action')\n                        if (buttonAction === 'CLOSE_FORM') {\n                            button.setAttribute(\"type\", \"button\");\n                            button.onclick = closePopup;\n                        }\n                        else if (buttonAction === 'GO_TO_URL') {\n                            let url = button.getAttribute('data-button-url');\n\n                            if (!!url && !!url.trim()) {\n                                url = url.trim();\n                                if (!/^(https?:)?\\/\\//i.test(url)) {\n                                    url = 'https://' + url;\n                                }\n                            }\n\n                            button.setAttribute(\"type\", \"button\");\n                            button.onclick = () => {\n                                window.open(url, \"_blank\");\n                            }\n                        }\n                        else if (buttonAction === 'COPY_DISCOUNT') {\n                            button.setAttribute(\"type\", \"button\");\n                            const discountBlock = container.querySelector('[data-custom-type=\"DISCOUNT_CODE\"]')\n                            if (discountBlock) {\n                                const el = document.createElement('textarea');\n                                el.value = discountBlock.textContent;\n                                document.body.appendChild(el);\n                                el.select();\n                                document.execCommand('copy');\n                                document.body.removeChild(el);\n                            }\n                        }\n\n                        else if (buttonAction === \"SUBMIT_FORM\") {\n                            if (isSuccess) {\n                                button.setAttribute(\"type\", \"button\");\n                                button.onclick = closePopup;\n                            }\n                            else {\n                                button.setAttribute(\"type\", \"submit\");\n                                submitButtons.push(button)\n                            }\n                        }\n                    })\n                }\n\n                processButtons(false);\n\n                const enableSubmitButtonsLoading = () => {\n                    submitButtons.forEach(button => {\n                        button.classList.add(buttonSpinnerClassname)\n                        button.style.position = 'relative'\n                        button.setAttribute('disabled', '')\n                    })\n                }\n\n                const disableSubmitButtonsLoading = () => {\n                    submitButtons.forEach(button => {\n                        button.classList.remove(buttonSpinnerClassname)\n                        button.removeAttribute('disabled')\n                    })\n                }\n\n                const imageElements = container.querySelectorAll('img');\n                imageElements.forEach(imageEl => {\n                    const url = imageEl.getAttribute(\"data-image-link\")?.trim?.();\n                    if (url) {\n                        imageEl.onclick = () => {\n                            window.open(url, \"_blank\");\n                        };\n                        imageEl.style.cursor = \"pointer\";\n                    }\n                })\n\n                const selectElements = container.querySelectorAll('select')\n                selectElements.forEach(selectElement => {\n                    // add empty option to select\n                    const emptyOption = document.createElement('option')\n                    emptyOption.setAttribute('value', '')\n                    emptyOption.setAttribute('selected', '')\n                    emptyOption.setAttribute('disabled', '')\n                    emptyOption.setAttribute('hidden', '')\n                    emptyOption.innerText = 'select an option'\n                    selectElement.insertBefore(emptyOption, selectElement.firstChild)\n                })\n\n\n                const radioElements = container.querySelectorAll('[data-custom-type=\"radio\"]')\n                const processedRadioContainers = []\n                radioElements.forEach(radioElement => {\n                    //find parent node\n                    //if parent node is in processedRadioContainers, skip\n                    //get name of parent node\n                    //put parent node in processed radio containers\n                    //set name attribute of radio elements inside parent node to name of parent node\n                    //remove name attribute from parent node\n\n                    const parentNode = radioElement.parentNode\n                    if (processedRadioContainers.includes(parentNode)) return\n                    processedRadioContainers.push(parentNode)\n\n                    const name = parentNode.getAttribute('name')\n                    parentNode.removeAttribute('name')\n                    const required = parentNode.hasAttribute('required')\n                    parentNode.removeAttribute('required')\n\n                    const childRadioElements = parentNode.querySelectorAll('[type=\"radio\"]')\n                    childRadioElements.forEach(childRadioElement => {\n                        if (name) {\n                            childRadioElement.setAttribute('name', name)\n                        }\n                        else {\n                            childRadioElement.removeAttribute('name')\n                        }\n                        if (required) {\n                            childRadioElement.setAttribute('required', '')\n                        }\n                        else {\n                            childRadioElement.removeAttribute('required')\n                        }\n                    })\n                })\n\n                const checkboxElements = container.querySelectorAll('[data-custom-type=\"checkbox\"]')\n                const processedCheckboxContainers = []\n                checkboxElements.forEach(checkboxElement => {\n\n                    const parentNode = checkboxElement.parentNode\n                    if (processedCheckboxContainers.includes(parentNode)) return\n                    processedCheckboxContainers.push(parentNode)\n\n                    const name = parentNode.getAttribute('name')\n                    parentNode.removeAttribute('name')\n                    const required = parentNode.hasAttribute('required')\n                    parentNode.removeAttribute('required')\n\n                    const childCheckboxElements = parentNode.querySelectorAll('[type=\"checkbox\"]')\n                    childCheckboxElements.forEach(childCheckboxElement => {\n                        if (name) {\n                            childCheckboxElement.setAttribute('name', name + '[]')\n                        }\n                        else {\n                            childCheckboxElement.removeAttribute('name')\n                        }\n                        if (required) {\n                            childCheckboxElement.setAttribute('required', '')\n                        }\n                        else {\n                            childCheckboxElement.removeAttribute('required')\n                        }\n                    })\n                })\n\n                ifrm.contentWindow.onIntlTelInputLoad = function (telInputElement) {\n                    if (!telInputElement) return\n                    if (telInputElement) {\n                        var iti = ifrm.contentWindow.intlTelInputGlobals.getInstance(telInputElement);\n                        if (!iti) return\n\n                        if (window.clientCountryCode) {\n                            iti.setCountry(window.clientCountryCode);\n                        }\n\n                        container.querySelectorAll('.iti__flag').forEach((el) => {\n                            el.style.display = 'block'\n                        })\n                        container.querySelectorAll('.iti__arrow').forEach((el) => {\n                            el.style.display = 'block'\n                        })\n\n                        telInputElement.addEventListener(\"open:countrydropdown\", function () {\n                            const dropdownContainer = ifrm.contentWindow.document.querySelector('.iti.iti--container')\n                            dropdownContainer.style.zIndex = '99999'\n                        });\n                    }\n                }\n\n\n                let phoneInput = null\n\n                const telInputElement = ifrm.contentWindow.document.querySelector(`[type='tel'][name='mobile'][data-main-comp=\"true\"]`)\n                if (telInputElement) {\n                    const input = telInputElement;\n                    const inputParent = input.parentNode;\n                    phoneInput = input\n                    inputParent.insertAdjacentHTML('afterend',\n                        `\n                        <span id=\"error-msg\" class=\"hide\" style='color:red;'></span>\n                        `\n                    )\n\n                    const errorMsg = ifrm.contentWindow.document.querySelector(\"#error-msg\");\n                    const validMsg = ifrm.contentWindow.document.querySelector(\"#valid-msg\");\n\n                    // here, the index maps to the error code returned from getValidationError - see readme\n                    var errorMap = [\"Invalid number\", \"Invalid country code\", \"Too short\", \"Too long\", \"Invalid number\"];\n\n                    var reset = function () {\n                        input.classList.remove(\"error\");\n                        errorMsg.innerHTML = \"\";\n                        errorMsg.classList.add(\"hide\");\n                        // validMsg.classList.add(\"hide\");\n                    };\n\n                    // on blur: validate\n                    input.addEventListener('blur', function () {\n                        reset();\n                        if (input.value.trim()) {\n                            var iti = ifrm.contentWindow.intlTelInputGlobals.getInstance(input);\n                            if (iti.isValidNumber()) {\n                                // validMsg.classList.remove(\"hide\");\n                            } else {\n                                input.classList.add(\"error\");\n                                var errorCode = iti.getValidationError();\n                                errorMsg.innerHTML = errorMap[errorCode] || \"Invalid number\";\n                                errorMsg.classList.remove(\"hide\");\n                            }\n                        }\n                    });\n\n                    // on keyup / change flag: reset\n                    input.addEventListener('change', reset);\n                    input.addEventListener('keyup', reset);\n                }\n\n\n                const form = container.querySelector('form')\n\n                form.addEventListener(\"submit\", async (e) => {\n                    e.preventDefault()\n\n                    enableSubmitButtonsLoading()\n\n\n                    try {\n                        const formData = new FormData(e.target);\n                        const formProps = Object.fromEntries(formData);\n\n\n                        if (phoneInput) {\n                            const input = phoneInput\n                            if (input.value.trim()) {\n                                var iti = ifrm.contentWindow.intlTelInputGlobals.getInstance(input);\n                                if (iti.isValidNumber()) {\n                                    var number = iti.getNumber();\n                                    formProps.mobile = number\n                                } else {\n                                    disableSubmitButtonsLoading()\n                                    return\n                                }\n                            }\n                        }\n\n\n                        for (let name in formProps) {\n                            if (name.endsWith('[]')) {\n                                const fields = container.querySelectorAll(`[name=\"${name}\"]`)\n                                const values = []\n                                fields.forEach(field => {\n                                    if (field.checked) {\n                                        values.push(field.value)\n                                    }\n                                })\n\n                                //remove terminal [] and add to formProps\n                                formProps[name.slice(0, -2)] = values\n                                delete formProps[name]\n                            }\n                        }\n\n\n\n                        const formSubmitResp = await api.Services.submitForm(popup.id, formProps)\n\n                        if (!formSubmitResp.ok) {\n                            throw new Error('Something went wrong');\n                        }\n\n                        isFormSubmitted = true\n\n                        const formSubmitRespJson = await formSubmitResp.json();\n                        const respSuccessDoc = formSubmitRespJson.successDoc;\n                        const respUid = formSubmitRespJson.uid;\n                        if (respUid && !api.getUidCookie()) {\n                            api.setUidCookie(respUid)\n                        }\n\n                        if (version) {\n                            const { successData } = popup;\n                            const outerWrapper = ifrm.contentWindow.document.getElementById('OUTER_WRAPPER');\n                            const outerWrapperHeight = outerWrapper.offsetHeight;\n                            outerWrapper.style.minHeight = outerWrapperHeight + 'px';\n\n                            // replace with success html and css\n                            const elementCssStyleElement = ifrm.contentWindow.document.getElementById('elementsCss');\n                            elementCssStyleElement.innerHTML = successData.css\n\n                            const formContanier = ifrm.contentWindow.document.getElementById('FORM_CONTAINER');\n\n                            if (respSuccessDoc) {\n                                formContanier.innerHTML = respSuccessDoc;\n                            }\n                            else {\n                                formContanier.innerHTML = successDoc;\n                            }\n\n\n\n                        }\n                        else {\n                            // clear container\n                            while (container.firstChild) {\n                                container.removeChild(container.firstChild);\n                            }\n\n                            // add success html\n                            if (respSuccessDoc) {\n                                container.insertAdjacentHTML('afterbegin', respSuccessDoc);\n                            }\n                            else {\n                                container.insertAdjacentHTML('afterbegin', successDoc);\n                            }\n\n                            const closeIcon = ifrm.contentWindow.document.querySelector(`.la-popup-close-icon`)\n                            formElement = container.querySelector('form')\n\n                            closeIcon.onclick = closePopup;\n\n                            // form submited successfully\n                            api.bake_cookie(`popup-${popup.id}-submitted`, true)\n\n                            calculateAndSetClasses()\n                        }\n\n                        api.bake_cookie(`popup-${popup.id}-submitted`, true);\n                        console.log('done');\n\n\n                        processButtons(true);\n                    }\n                    catch (e) {\n                        console.log(e)\n                        disableSubmitButtonsLoading()\n\n                    }\n\n                });\n\n                const formParent = form.parentNode\n\n                // console.log({ formParent })\n\n                const calculateAndSetClasses = () => {\n                    const popupModal = container.querySelector(\"#ijwx\")\n                    const popupBackdrop = popupModal.parentNode\n\n                    const type = popupType\n\n                    if (type === 'popup') {\n                        popupModal.className = this.popupClassNames.popupWindow;\n                        popupBackdrop.className = this.popupClassNames.popupBackdrop;\n                    }\n                    else if (type === 'flyout') {\n                        popupModal.className = this.popupClassNames.flyoutWindow;\n                        popupBackdrop.className = this.popupClassNames.flyoutBackdrop;\n\n                        animateFlyout && popupModal.classList.add(`${this.popupClassNames.generalPrefix}window-${flyoutPosition.charAt(flyoutPosition.length - 1)}`);\n                        popupBackdrop.classList.add(this.popupClassNames.generalPrefix + flyoutPosition)\n                        popupModal.classList.add(this.popupClassNames.slideInAnimation)\n                    }\n                }\n\n                calculateAndSetClasses();\n\n                if (popupType === 'popup') {\n                    const backdrop = await getElement(`.${this.popupClassNames.popupBackdrop}`, () => container);\n                    backdrop.onclick = function (e) {\n                        closePopup(e, true);\n                    };\n                }\n\n\n                var scripts = container.getElementsByTagName(\"script\");\n                while (scripts.length) {\n                    var script = scripts[0];\n                    script.parentNode.removeChild(script);\n                    var newScript = document.createElement(\"script\");\n                    if (script.src) {\n                        newScript.src = script.src;\n                    } else if (script.textContent) {\n                        newScript.textContent = script.textContent;\n                    } else if (script.innerText) {\n                        newScript.innerText = script.innerText;\n                    }\n                    ifrm.contentWindow.document.body.appendChild(newScript);\n                }\n\n\n                modalElement.classList.add(popupAnimationClassName);\n                ifrm = document.getElementById(iframeId);\n\n\n\n\n\n\n                if (popup.widgetData) {\n\n                    const { css, js, html } = popup.widgetData;\n\n                    const src = api.CurrentScript.src;\n                    const scriptUrl = new URL(src)\n                    const scriptSearchParams = scriptUrl.searchParams\n                    const shop = scriptSearchParams.get('shop')\n\n                    const widgetContainer = ifrm.contentWindow.document.createElement(\"div\");\n                    widgetContainer.innerHTML = html;\n                    const style = document.createElement(\"style\");\n                    style.innerHTML = css;\n\n                    ifrm.contentWindow.document.body.appendChild(style);\n                    const popupModal = container.querySelector(\"#FORM_CONTAINER\")\n                    popupModal.appendChild(widgetContainer);\n\n                    const script = document.createElement(\"script\");\n                    const apiBase = window.LATTICE_API;\n                    script.setAttribute(\"data-base-url\", apiBase);\n                    script.setAttribute(\"data-pid-cookie-name\", api.getFullCookieName('pid'));\n                    script.setAttribute(\"data-shop\", shop);\n                    script.innerHTML = js;\n                    ifrm.contentWindow.document.head.appendChild(script);\n                    ifrm.contentWindow.Shopify = window.Shopify;\n                    ifrm.contentWindow.is_shopagain_widget_popup = true;\n                }\n\n\n\n\n                ifrm.style.visibility = 'visible';\n                api.Services.createPopupActivity(popup.id, activityType, details = { url: window.location.href, view_id: popupViewId });\n\n\n            }, 300);\n\n        },\n        displayButtonToShowLastPopup: async function (popup) {\n            const lastPopUpButton = document.querySelector('.latticeai-popup-revert-button');\n            if (lastPopUpButton) {\n                lastPopUpButton.remove();\n            }\n            const { enable, vertical_position, horizontal_position, background_color, before_popup, after_popup_cancel } = popup.minimize_icon_config\n            if (!popup || !enable) {\n                return\n            }\n            const containerClassName = 'latticeai-popup-revert-button';\n            const iframeId = `latticeai-popup-revert-iframe-button`;\n            let container = document.createElement('div')\n            let ifrm = document.createElement(\"iframe\");\n            ifrm.setAttribute(\"id\", iframeId);\n            ifrm.style.visibility = 'hidden';\n            ifrm.style.position = \"fixed\";\n            ifrm.style.bottom = vertical_position === 'bottom' ? '0' : 'auto';\n            ifrm.style.right = horizontal_position === 'right' ? '0' : 'auto';\n            ifrm.style.top = vertical_position === 'top' ? '0' : 'auto';\n            ifrm.style.left = horizontal_position === 'left' ? '0' : 'auto';\n            ifrm.style.width = \"65px\";\n            ifrm.style.height = \"65px\";\n            ifrm.style.margin = \"15px\";\n            ifrm.style.zIndex = \"2147483647\";\n            ifrm.setAttribute(\"frameborder\", \"0\");\n            ifrm.style.borderRadius = \"50%\";\n            ifrm.setAttribute(\"srcdoc\", popup.minimize_icon);\n            container.appendChild(ifrm);\n\n\n            container.classList.add(containerClassName)\n\n            const body = document.body\n            body.appendChild(container)\n\n\n            setTimeout(async () => {\n\n                const getElement = (selector, parent) => new Promise(async (resolve) => {\n                    while (!parent().querySelector(selector)) {\n                        console.log('waiting for element', selector)\n                        await new Promise(res => setTimeout(res, 100));\n                    }\n                    resolve(parent().querySelector(selector))\n                });\n\n                container = await getElement(`.${containerClassName}`, () => ifrm.contentWindow.document);\n\n                const closeIcon = await getElement(`.shopagain-floating-container`, () => container);\n                const closePopup = (e) => {\n                    api.displayPopup(popup, \"OPEN_FROM_BUTTON\")\n                    ifrm.remove()\n\n                }\n\n                closeIcon.onclick = closePopup;\n                ifrm = document.getElementById(iframeId);\n                ifrm.style.visibility = 'visible';\n            }, 300);\n\n        },\n\n        checkIfPopupCanBeShown(popup) {\n\n            let { behaviour: {\n                frequency: { days_after_closing: show_days_after_closing } = {},\n                timing: { add_to_cart }\n            } = {} } = popup\n\n            if (add_to_cart) {\n                return true;\n            }\n\n\n            const popupSubmitted = api.read_cookie(`popup-${popup.id}-submitted`)\n            if (popupSubmitted) return false;\n\n            const popup_cookie = `popup-${popup.id}-closed-at`\n            const popupShown = api.read_cookie(popup_cookie)\n            if (popupShown) {\n                const popupShownDate = new Date(popupShown)\n                const now = new Date()\n                const timeDiff = Math.abs(now.getTime() - popupShownDate.getTime());\n                const days_since_close = Math.floor(timeDiff / (1000 * 3600 * 24));\n\n                if (isNaN(show_days_after_closing)) {\n                    show_days_after_closing = 10;\n                }\n\n                show_days_after_closing = Number(show_days_after_closing);\n\n                if (days_since_close < show_days_after_closing) {\n                    return false;\n                }\n            }\n\n            return true;\n        },\n\n\n        getFontLinks(doc) {\n            let fontMatches = []\n            doc.match(/font-family:\\s*([^;}]*)/g)?.forEach(font => {\n                const fontName = font.match(/font-family:\\s*([^;}]*)/)[1]\n                fontMatches.push(fontName)\n            })\n\n            fontMatches = [...new Set(fontMatches)]\n\n            const loadUrlLinks = []\n\n            fontMatches.forEach(fontMatch => {\n                api.customFonts.find(customFont => {\n                    if (fontMatch.toLowerCase().includes(customFont.name.toLowerCase())) {\n                        loadUrlLinks.push(customFont.url)\n                    }\n                })\n            })\n\n\n            if (loadUrlLinks.length) {\n                let fontLinksString = `\n                <link rel=\"preconnect\" href=\"https://fonts.googleapis.com\">\n                <link rel=\"preconnect\" href=\"https://fonts.gstatic.com\" crossorigin>\n\n                ${function () {\n                        return loadUrlLinks.map(url => {\n                            return `<link href=\"${url}\" rel=\"stylesheet\">`\n                        }).join('')\n                    }()\n                    }\n                `\n\n                return fontLinksString\n\n            }\n        },\n\n        customFonts: [\n            {\n                name: \"cabin\",\n                url: \"https://fonts.googleapis.com/css?family=Cabin:400,700\",\n                value: `Cabin, sans-serif`\n            },\n            {\n                name: \"Crimson Text\",\n                url: \"https://fonts.googleapis.com/css?family=Crimson+Text:400,700\",\n                value: `'Crimson Text', serif`,\n            },\n            {\n                name: \"Lato\",\n                url: \"https://fonts.googleapis.com/css?family=Lato:400,700\",\n                value: `'Lato', sans-serif`\n            },\n\n            {\n                name: \"Lobster Two\",\n                url: \"https://fonts.googleapis.com/css?family=Lobster+Two:400,700\",\n                value: `'Lobster Two', cursive`\n            },\n            {\n                name: \"QuickSand\",\n                url: \"https://fonts.googleapis.com/css?family=Quicksand:400,700\",\n                value: `'Quicksand', sans-serif`\n            },\n            {\n                name: \"Open Sans\",\n                url: \"https://fonts.googleapis.com/css?family=Open+Sans:400,700\",\n                value: `'Open Sans', sans-serif`\n            },\n            {\n                name: \"Montserrat\",\n                url: \"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700\",\n                value: `'Montserrat', sans-serif`\n            },\n            {\n                name: \"Roboto\",\n                url: \"https://fonts.googleapis.com/css2?family=Roboto:wght@400;700\",\n                value: `'Roboto', sans-serif`\n            },\n        ],\n        submitHandler: function (firstName, emailAddress) {\n            //This function handles the event when a visitor submits the form.\n        },\n\n        getFullCookieName(cookieName) {\n            if (LATTICEAI_ENV !== 'prod') {\n                return `latticeai-popups-${LATTICEAI_ENV}-${cookieName}`\n            }\n\n            return `latticeai-popups-${cookieName}`\n        },\n\n        bake_cookie(name, value, isSessionBased = false) {\n            name = api.getFullCookieName(name)\n            var date = new Date();\n            var days = 365;\n            date.setTime(date.getTime() + (10000 * 24 * 60 * 60 * 1000));\n            var expires = \"; expires=\" + date.toUTCString();\n            if (isSessionBased) {\n                expires = \"\";\n            }\n            var cookie = [name, '=', JSON.stringify(value), expires, '; domain=.', window.location.host.toString(), '; path=/;'].join('');\n            document.cookie = cookie;\n        },\n        getSameNameCookie(name) {\n            const value = `; ${document.cookie}`;\n            const parts = value.split(`; ${name}=`);\n            if (parts.length === 2) return parts.pop().split(';').shift();\n        },\n\n        read_cookie(name, exactName = false) {\n            if (!exactName)\n                name = api.getFullCookieName(name)\n            var result = document.cookie.match(new RegExp(name + '=([^;]+)'));\n            result && (result = JSON.parse(result[1]));\n            return result;\n        },\n\n        delete_cookie(name) {\n            name = api.getFullCookieName(name)\n            document.cookie = [name, '=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/; domain=.', window.location.host.toString()].join('');\n        },\n        getSessionStartTime() {\n            return api.read_cookie('sessionStartTime')\n        },\n        setSessionStartTime(time) {\n            api.bake_cookie('sessionStartTime', time)\n        },\n        deleteSessionId: function () {\n            api.delete_cookie('session_id')\n        },\n        getSessionId() {\n            return api.read_cookie('session_id') || null\n        },\n        setSessionId(time) {\n            api.bake_cookie('session_id', time)\n        },\n        setSessionStatus(type) {\n            api.bake_cookie('sessionStatus', type)\n        },\n        getSessionStatus() {\n            return api.read_cookie('sessionStatus')\n        },\n        setPopUpSessionMap(type) {\n            api.bake_cookie('popUpSessionMap', type, true)\n        },\n        getPopUpSessionMap() {\n            return api.read_cookie('popUpSessionMap') ?? {}\n        },\n        setPidCookie: function (pid) {\n            api.bake_cookie('pid', pid)\n        },\n        getCartToken: function () {\n            return api.getSameNameCookie('cart')\n        },\n        getPidCookie: function () {\n            return api.read_cookie('pid')\n        },\n        setSessionInactiveTime: function (time) {\n            api.bake_cookie('inactiveTime', time)\n        },\n        getSessionInactiveTime: function () {\n            return api.read_cookie('inactiveTime') || null\n        },\n        deleteSessionInactiveTime: function () {\n            api.delete_cookie('inactiveTime')\n        },\n        setUidCookie: function (uid) {\n            api.bake_cookie('uid', uid)\n        },\n\n        getUidCookie: function () {\n            return api.read_cookie('uid')\n        },\n\n        deleteUidCookie: function () {\n            api.delete_cookie('uid')\n        },\n\n        deletePidCookie: function () {\n            api.delete_cookie('pid')\n        },\n        isMobileDevice: function () {\n            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n        },\n        preloadImagesFromHtmlString: async function (htmlString) {\n            // extract all image urls\n            const imageUrls = htmlString.match(/(http)?s?:?(\\/\\/[^\"']*\\.(?:png|jpg|jpeg|gif|png|svg|webp))/g)\n            //preload all imageUrls, and wait for them to load\n            const images = imageUrls.filter(image => !image.includes(\"cdnjs\")).map(url => {\n                return new Promise((resolve, reject) => {\n                    const img = new Image()\n                    img.onload = () => resolve(url)\n                    img.onerror = () => reject(url)\n                    img.src = url\n                })\n            })\n\n            try {\n                await Promise.allSettled(images)\n            }\n            catch (e) {\n\n            }\n        },\n\n        popupClassNames: {\n            popupWindow: 'latticeai-popup-window' + randomKey,\n            flyoutWindow: 'latticeai-flyout-window' + randomKey,\n\n            popupBackdrop: 'latticeai-popup-backdrop' + randomKey,\n            flyoutBackdrop: 'latticeai-flyout-backdrop' + randomKey,\n\n            slideInAnimation: 'latticeai-slide-in-animation' + randomKey,\n            slideInAnimationKeyFrame: 'latticeai-slide-in-animation-key-frame' + randomKey,\n\n            generalPrefix: 'latticeai-popups' + randomKey + '-',\n        },\n\n\n        Services: {\n\n            getQueryString: function (parameters) {\n                var kvps = [];\n                var keys = Object.getOwnPropertyNames(parameters);\n\n                for (var i = 0; i < keys.length; i++) {\n                    var key = keys[i];\n                    kvps.push(key + \"=\" + parameters[key]);\n                }\n\n                var qs = \"?\" + kvps.join(\"&\");\n                return qs\n            },\n\n            updateOptions: function (options) {\n                const update = { ...options };\n                update.headers = {\n                    ...update.headers,\n                    'companyid': api.company_id,\n                    'apikey': api.apikey\n                };\n                if (update.body) {\n                    function fromEntries(entries) {\n                        var res = {};\n                        for (var i = 0; i < entries.length; i++) res[entries[i][0]] = entries[i][1];\n                        return res;\n                    }\n                    if (!Object.fromEntries) Object.fromEntries = fromEntries;\n\n                    const body = JSON.parse(update.body);\n                    const newBody = {\n                        script_query_params: Object.fromEntries(api.scriptSearchParams),\n                        ...body\n                    }\n                    update.body = JSON.stringify(newBody);\n                }\n                return update;\n            },\n            baseUrl: window.LATTICE_API,\n            getUrl: function (path) {\n                return new URL(path, this.baseUrl).toString()\n            },\n\n            getPopupUser: function (shopify_customer_id, pid, uid) {\n                return fetch(this.getUrl(`/campaigns/popups/get_popup_user/`),\n                    this.updateOptions({\n                        method: 'POST',\n                        body: JSON.stringify({\n                            shopify_customer_id,\n                            pid,\n                            uid,\n                            user_timezone: Intl.DateTimeFormat().resolvedOptions().timeZone\n                        }),\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                    }))\n            },\n            getCartDetails: function () {\n                return fetch('/cart.js')\n                    .then(response => response.json())\n            },\n            createOrUpdateCart: function (params) {\n                return fetch(this.getUrl(`/audience/cart/`),\n                    this.updateOptions({\n                        method: 'POST',\n                        body: JSON.stringify(params),\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                    }))\n            },\n            createEventActivity: function (params) {\n                return fetch(this.getUrl(`/campaigns/event/`),\n                    this.updateOptions({\n                        method: 'POST',\n                        body: JSON.stringify(params),\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                    }))\n            },\n\n            createPopupActivity: function (id, activity_type, details = {}) {\n                return fetch(this.getUrl(`/campaigns/popups/${id}/popup_activity/`),\n                    this.updateOptions({\n                        method: 'POST',\n                        body: JSON.stringify({\n                            activity_type: activity_type,\n                            pid: api.getPidCookie(),\n                            uid: api.getUidCookie(),\n                            details: details,\n                            session_id: api.session_id || null,\n                        }),\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n                    }))\n            },\n\n            getConfig: function (pid, uid) {\n                const queryStringParams = {}\n                pid && (queryStringParams.pid = pid)\n                uid && (queryStringParams.uid = uid)\n                queryStringParams.isMobile = api.isMobileDevice()\n                return fetch(this.getUrl(\"/campaigns/popups/get_config/\") + this.getQueryString(queryStringParams), this.updateOptions({}))\n            },\n\n            submitForm: function (id, form_data) {\n                return fetch(this.getUrl(`/campaigns/popups/${id}/submit_form/`),\n                    this.updateOptions({\n                        method: 'POST',\n                        body: JSON.stringify({\n                            form_data: form_data,\n                            pid: api.getPidCookie(),\n                            uid: api.getUidCookie(),\n                        }),\n                        headers: {\n                            'Content-Type': 'application/json'\n                        },\n\n                    })\n                )\n            },\n\n        }\n    };\n\n\n    const polyfillScript = document.createElement(\"script\");\n    polyfillScript.src = `https://polyfill.io/v3/polyfill.min.js?callback=on_shopagainio_${LATTICEAI_ENV}_polyfill_load&features=Intl%2Cblissfuljs%2Cdefault%2Cdom4%2Ces2015%2Ces2016%2Ces2017%2Ces2018%2Ces2019%2Ces2020%2Ces2021%2Ces2022%2Ces5%2Ces6%2Ces7`;\n    document.head.appendChild(polyfillScript);\n    api.CurrentScript = document.currentScript;\n    window[`on_shopagainio_${LATTICEAI_ENV}_polyfill_load`] = () => {\n        //Start the widget\n        if (api.isCookiesEnabled) {\n            api.start();\n        }\n\n        api.addWidgetScript(new URL(api.CurrentScript.src));\n    };\n\n}());\n"]}